0010 REM "MPR - Production Schedule Listing (Report Overlay)"
0020 REM "Program MPR.GB"
0022 REM "+-----------------------------------------------------------+"
0024 REM "| ADD+ON Software, Inc. Advantage/V Version 6.0.0           |
0026 REM "|      Copyright BASIS International Ltd.                   |
0028 REM "|                  All Rights Reserved                      |"
0030 REM "+-----------------------------------------------------------+"
0040 REM 
0085 SETESC 9000
0090 SETERR 9000
0100 REM " --- Open/Lock Files"
0170 CALL "SYC.GA",7,1,"","",STATUS
0175 IF STATUS THEN GOTO 9900
0200 REM " --- IOLIST's"
0210 MPE01A: IOLIST A0$(1),A1$(1),A[ALL]
0230 BMM01A: IOLIST B0$(1),B1$,B2$(1),B[ALL]
0250 IVM01A: IOLIST D0$(1),D1$(1),D2$(1),D3$,D4$,D5$,D6$,D[ALL]
0280 IVM02A: IOLIST W0$(1),W1$(1),W2$,W[ALL]
0500 REM " --- Initializations"
0505 PRECISION IVS01_PRECISION
0510 DIM A0$(27),A1$(100),A[MP]
0550 LET HEADINGS$[1]=HEADINGS$[1]+" For "+H5$
0560 LET CLOCK$="",WHEN$=F0$(7,3),PAGE=0,WIDTH=132
0570 LET PREFIX$=FNP$(N0$+FORECAST$+WHSE$+BEGITEM$)
0580 LET NUMBER=ENDPER-BEGPER+2,X$=" No Bill Of Materials Defined "
0590 IF ALLBUYERS>0 THEN LET BUYER$=""
0600 REM " --- Print positions"
0610 DIM O[10],PLANDATE$[NUMBER]
0615 LET O[10]=WIDTH-8,O[9]=O[10]-10,O[8]=O[9]-10,O[7]=O[8]-11
0620 LET O[6]=O[7]-9,O[5]=O[6]-M2-1,O[4]=O[5]-M2-1,O[3]=O[4]-4
0625 LET O[2]=O[3]-M5-1,O[1]=P[0],DW=O[2]-O[1]+1,X=WIDTH-O[1]-15
0630 LET NUMCOL=INT(X/M2)
0635 IF NUMCOL>NUMBER THEN LET NUMCOL=NUMBER
0640 DIM NB$(WIDTH-O[5],"-")
0645 LET BEGPER=BEGPER-1,ENDPER=ENDPER-1,POSITION=WIDTH-M2*NUMCOL,N=0
0650 LET HR=WIDTH-MAX(LEN(H7$),LEN(H8$)),NB$(FNC(X$,LEN(NB$)),LEN(X$))=X$
0660 FOR X=BEGPER TO ENDPER
0670 LET N=N+1,PLANDATE$[N]=FNB6$(S2$(X*6+1,6))
0680 NEXT X
0690 LET PLANDATE$[NUMBER]="  Totals"
0700 REM " --- Background"
0710 CALL "SYC.NB","Printing",P[0],COLUMN
0900 REM " --- Position file"
0990 READ (MPE01_DEV,KEY=PREFIX$,DOM=1000)
1000 REM " --- Read next MPE-01 record"
1010 READ (MPE01_DEV,END=4000)IOL=MPE01A
1020 IF POS(PREFIX$=A0$)<>1 THEN GOTO 4000
1030 IF FNP$(ENDITEM$)<>"" THEN IF A0$(8,P[0])>ENDITEM$ THEN GOTO 4000
1050 PRINT @(COLUMN,11),A0$(8,P[0]),
1200 REM " --- Additional reads"
1210 DIM D0$(22),D1$(P[2]+P[3]+P[4]),D2$(40),D[8],DESC$(DW)
1220 DIM W0$(24),W1$(40),W[16]
1230 LET D0$(1)=N0$+A0$(8),W0$(1)=N0$+WHSE$+A0$(8)
1240 FIND (IVM01_DEV,KEY=D0$,DOM=1250)IOL=IVM01A
1250 FIND (IVM02_DEV,KEY=W0$,DOM=1260)IOL=IVM02A
1260 IF BUYER$<>"" THEN IF W1$(19,3)<>BUYER$ THEN GOTO 3900
1290 LET DESC$(1)=FNZ$(D1$,P[2],P[3],P[4])
1300 REM " --- Bill of materials?"
1310 DIM B0$(52),B2$(57),B[11]
1320 LET REVCODE$="",LOT$="",PHANTOM$="",YIELD$="",CREATED$=""
1330 LET REVISION$="",USED$="",BILL$="",B0$(1)=D0$
1340 FIND (BMM01_DEV,KEY=B0$(1,22),DOM=1500)IOL=BMM01A
1400 REM " --- Format bill fields"
1410 LET REVCODE$=B2$(38,2),PHANTOM$="No",CREATED$=FNB$(B2$(45,3))
1420 LET REVISION$=FNB$(B2$(35,3)),USED$=FNB$(B2$(41,3)),BILL$="Y"
1430 IF B2$(40,1)="Y" THEN LET PHANTOM$="Yes"
1440 IF B[4]>999.99 THEN LET B[4]=999.99
1450 IF B[4]<-999.99 THEN LET B[4]=-999.99
1460 LET YIELD$=STR(B[4]:"-##0.00")+"%",LOT$=STR(B[5]:M2$)
1500 REM " --- Print item heading"
1510 IF L+5>L9 THEN GOSUB 5000
1520 GOSUB 5200
2000 REM " --- Build detail"
2010 DIM AMOUNTS[NUMBER]
2050 LET N=0
2100 REM 
2110 FOR X=BEGPER TO ENDPER
2120 LET N=N+1,AMOUNTS[N]=A[X]
2130 NEXT X
2200 REM " --- Detail printing initializations"
2210 LET LAST=0
2220 FOR X=1 TO NUMBER-1
2230 LET AMOUNTS[NUMBER]=AMOUNTS[NUMBER]+AMOUNTS[X]
2240 NEXT X
2300 REM " --- Print detail"
2310 LET FIRST=LAST+1,LAST=FIRST+NUMCOL-1
2320 IF FIRST>NUMBER THEN GOTO 3000
2330 IF LAST>NUMBER THEN LET LAST=NUMBER
2340 IF L+3<L9 THEN GOTO 2400
2350 GOSUB 5000
2360 GOSUB 5200
2400 REM " --- Plan Date"
2410 DIM BUFFER$(WIDTH)
2420 LET BUFFER$(POSITION-5)="Date",N=POSITION
2430 FOR X=FIRST TO LAST
2440 LET BUFFER$(N+M2-9)=PLANDATE$[X],N=N+M2
2450 NEXT X
2480 PRINT (7)""
2490 PRINT (7)BUFFER$
2500 REM " --- Amounts"
2510 DIM BUFFER$(WIDTH)
2520 LET BUFFER$(POSITION-9)="Quantity",N=POSITION
2530 FOR X=FIRST TO LAST
2540 LET BUFFER$(N)=STR(AMOUNTS[X]:M2$),N=N+M2
2550 NEXT X
2560 PRINT (7)BUFFER$
2590 LET L=L+3
2900 REM 
2990 GOTO 2300
3900 REM " --- Loop back for next record"
3990 GOTO 1000
4000 REM " --- All done"
4090 GOTO 9900
5000 REM " --- Heading"
5010 LET L=HEADINGS+5
5020 CALL "SYC.HA",7,HEADINGS$[ALL],HEADINGS,PAGE,WIDTH,WHEN$,CLOCK$,STATUS
5030 IF STATUS>0 THEN EXITTO 9900
5040 PRINT (7)H6$,@(FNC(P9$,WIDTH)),P9$,@(HR),H7$
5050 PRINT (7)H9$,@(HR),H8$
5060 PRINT (7)""
5070 PRINT (7)@(O[2]),"Lead",@(O[5]+M2-4),"Lot",@(O[6]),"Phantom",@(O[7]),"Est
5070:imated",@(O[8]+2),"Bill",@(O[9]+2),"Last",@(O[10]+2),"Last"
5080 PRINT (7)"Item",@(O[1]),"Description",@(O[2]),"Time",@(O[3]),"Rev",@(O[4]
5080:+M2-4),"EOQ",@(O[5]+M2-5),"Size",@(O[6])," Bill?",@(O[7]+2),"Yield",@(O[8
5080:]),"Created",@(O[9]),"Revision",@(O[10]+2),"Used"
5090 RETURN
5200 REM " --- Item Heading"
5210 PRINT (7)""
5220 IF BILL$="" THEN GOTO 5250
5230 PRINT (7)D0$(3),@(O[1]),DESC$,@(O[2]),D[6]:M5$,@(O[3]),REVCODE$,@(O[4]),D
5230:[1]:M2$,@(O[5]),LOT$,@(O[6]+3),PHANTOM$,@(O[7]),YIELD$,@(O[8]),CREATED$,@
5230:(O[9]),REVISION$,@(O[10]),USED$
5240 GOTO 5280
5250 PRINT (7)D0$(3),@(O[1]),DESC$,@(O[2]),D[6]:M5$,@(O[4]),D[1]:M2$,@(O[5]),N
5250:B$
5280 LET L=L+2
5290 RETURN
8000 REM " --- Functions"
8010 DEF FNA$(Q$,Q2$)=STR(MOD((ASC(Q$)-32)*POS(" "<>Q2$(2,1)),100):"00")
8020 DEF FNB$(Q1$)=FNA$(Q1$(2),Q1$)+"/"+FNA$(Q1$(3),Q1$)+"/"+FNA$(Q1$(1),Q1$)
8025 DEF FNB6$(Q$)=Q$(3,2)+"/"+Q$(5,2)+"/"+FNYY21_YY$(Q$(1,2))
8060 DEF FNC(Q$,Q)=INT((Q-LEN(Q$))/2)
8070 DEF FNP$(Q$)=CVS(Q$,2)
8090 DEF FNZ$(Q$,Q1,Q2,Q3)=CVS(Q$(1,Q1)+" "+Q$(Q1+1,Q2)+" "+Q$(Q1+Q2+1,Q3),32)
8145 REM " --- FNYY21_YY$ Un-Convert 21st Century 2-Char Year to 2-Char Year"
8150 DEF FNYY21_YY$(Q1$)
8155 LET Q3$=" 01234567890123456789",Q1$(1,1)=Q3$(POS(Q1$(1,1)=" 0123456789ABC
8155:DEFGHIJ"))
8160 RETURN Q1$
8165 FNEND
9000 REM " --- Standard Error Routine (15May95)"
9010 IF ERR=127 THEN GOTO 9300
9020 CALL "SYC.EA",ERR=9090,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9030 IF E1=1 THEN GOTO 9100
9040 IF E1=3 THEN GOTO 9200
9080 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9090 ESCAPE
9100 REM " --- Retry"
9190 RETRY
9200 REM " --- Return"
9290 GOTO 9900
9300 REM " --- Standard Escape Routine"
9310 CALL "SYC.ES",ERR=9350,PGM(-2),TCB(8),E$,E2,V3
9320 IF V3<>127 THEN GOTO 9390
9330 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9350 ESCAPE
9390 RETURN
9900 RUN "SYS.AA"
9999 END
