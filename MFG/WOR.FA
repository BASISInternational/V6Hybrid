0010 REM "WOR - Labor Efficiency Analysis Report"
0020 REM "Program:  WOR.FA"
0022 REM "+-----------------------------------------------------------+"
0024 REM "| ADD+ON Software, Inc. Advantage/V Version 6.0.0           |
0026 REM "|      Copyright BASIS International Ltd.                   |
0028 REM "|                  All Rights Reserved                      |"
0030 REM "+-----------------------------------------------------------+"
0040 REM 
0050 BEGIN
0085 SETESC 9000
0090 SETERR 9000
0100 REM " --- Open/Lock Files
0110 LET FILES=10
0120 DIM FILES$[FILES],OPTIONS$[FILES],CHANNELS[FILES]
0125 LET FILES$[1]="IVM-01",FILES$[2]="WOE-01",FILES$[3]="WOE-02"
0130 LET FILES$[4]="WOM-02",FILES$[5]="WOM-10",FILES$[6]="WOT-01"
0140 LET FILES$[7]="WOT-03",FILES$[8]="WOW-05",FILES$[9]="SYS-01"
0150 LET FILES$[10]="BMM-08"
0155 LET OPTIONS$[8]="C"
0160 CALL "SYC.DA",1,1,9,FILES$[ALL],OPTIONS$[ALL],CHANNELS[ALL],BATCH,STATUS
0170 IF STATUS<>0 THEN GOTO 9900
0175 LET IVM01_DEV=CHANNELS[1],WOE01_DEV=CHANNELS[2],WOE02_DEV=CHANNELS[3]
0180 LET WOM02_DEV=CHANNELS[4],WOM10_DEV=CHANNELS[5],WOT01_DEV=CHANNELS[6]
0185 LET WOT03_DEV=CHANNELS[7],WOW05_DEV=CHANNELS[8],SYS01_DEV=CHANNELS[9]
0200 REM " --- IOLists
0210 WOE01A: IOLIST A0$,A1$,A[ALL]
0220 WOE02A: IOLIST W0$,W1$,W[ALL]
0230 WOT0103A: IOLIST W0$,W1$,W[ALL]; REM " Used for WOT01A & WOT03A
0240 WOW05A: IOLIST B0$,B1$,B[ALL]
0300 SYS01T: IOLIST X$,F0$,X$,X$,X$,F4$,F5$
0310 GLS01A: IOLIST X$,G1$,G2$,G3$,G4$,G5$,G6$,G7$
0320 IVS01A: IOLIST X$,X$,I9$
0330 WOS01A: IOLIST P0$,P1$,P2$,P3$,P4$,M0$,M1$,M2$,M3$
0400 REM " --- Parameters
0410 FIND (SYS01_DEV,KEY="T"+FID(0),DOM=9800)IOL=SYS01T
0420 LET N0$=F0$(16,2),N1$=F4$,N2$="WO",N3$=F5$
0430 FIND (SYS01_DEV,KEY=N0$+N2$+"00",DOM=9800)IOL=WOS01A
0440 FIND (SYS01_DEV,KEY=N0$+"GL00",DOM=9800)IOL=GLS01A
0450 FIND (SYS01_DEV,KEY=N0$+"IV00",DOM=9800)IOL=IVS01A
0500 REM " --- Init Data
0505 LET H0=132,H=0,HEADINGS=3,WHEN$=F0$(7,3),CLOCK$=""
0510 DIM HEADINGS$[HEADINGS](H0)
0515 LET HEADINGS$[0]=N1$,HEADINGS$[1]=N3$,L9=59,L=L9+1
0520 DIM A0$(85),A1$(110),A[11],DESC[3]
0530 LET BMINSTALLED$=P3$(1,1)
0540 FOR X=1 TO 3; LET DESC[X]=NUM(I9$((X-1)*2+9,2)); NEXT X
0550 LET BMINSTALLED$=P3$(1,1)
0560 CALL "SYC.RM",M1$,M1,8,12
0570 CALL "SYC.RM",M2$,M2,5,11
0575 LET M9=M1*4+M2*3
0580 REM " --- Find last (prior) Period End Date
0585 LET CURPER=NUM(P4$(1,2)),PRIORPER=CURPER-1,CURYEAR=FNYY_YEAR(P4$(3,2)); I
0585:F PRIORPER=0 THEN LET PRIORPER=NUM(G2$(1,2)),PRIORYEAR=CURYEAR-1
0590 CALL "SYC.PA",SYS01_DEV,PRIORPER,PRIORYEAR,V0$,PRIORPERENDDT$,STATUS
0600 REM " --- Additional File Opens
0610 IF BMINSTALLED$<>"Y" THEN GOTO 0700
0660 CALL "SYC.DA",1,10,10,FILES$[ALL],OPTIONS$[ALL],CHANNELS[ALL],BATCH,STATU
0660:S
0670 IF STATUS<>0 THEN GOTO 9900
0675 LET BMM08_DEV=CHANNELS[10]
0700 REM " --- Background
0710 FOR X=4 TO 12 STEP 2
0720 CALL "SYC.WC",1,0,80,0,0,X,0
0730 NEXT X
0740 PRINT 'SB',@(23,3),"Beginning Date:",@(26,5),"Ending Date:",@(13,7),"Sort
0740: By Work Order Type?: ",@(17,9),"Selected WO Category:",@(21,11),"Open/Cl
0740:osed/Both:",
0760 PRINT 'SF'
1000 REM " --- Enter Parameters
1010 LET V0$="D",V1$="C",V2$=DATEFROM$,V3$="",V4$="Enter Beginning Dates To An
1010:alyze, <F1>=First",V0=3,V1=40,V2=3,I0=0
1020 GOSUB 7000
1030 IF V3=1 THEN LET V$=""
1040 IF V3=4 THEN GOTO 9900
1050 IF V$<>"" THEN GOTO 1090
1060 PRINT @(V1,V2),"First",'CL'
1070 LET DATEFROM$=""
1080 GOTO 1100
1090 LET DATEFROM$=V$
1100 GOTO 3900
1200 REM " --- Ending Date
1210 LET V0$="D",V1$="C",V2$=DATETHRU$,V3$="",V4$="Enter Ending Dates To Analy
1210:ze, <F1>=Last ",V0=3,V1=40,V2=5
1220 GOSUB 7000
1230 IF V3=1 THEN LET V$=""
1240 IF V3=4 THEN GOTO 9900
1250 IF V$<>"" THEN GOTO 1290
1260 PRINT @(V1,V2),"Last",'CL'
1270 LET DATETHRU$=""
1280 GOTO 1390
1290 IF V$<DATEFROM$ THEN GOTO 1200
1300 LET DATETHRU$=V$
1390 GOTO 3900
1400 REM " --- Sort By W/O Type?
1410 IF SUBBYWO$="" THEN LET SUBBYWO$="Y"
1420 LET V0$="Y",V1$="C",V2$=SUBBYWO$,V3$="",V4$="Subtotal By Work Order Types
1420: Within Op Codes? (Y/N) ",V0=1,V1=40,V2=7
1440 GOSUB 7000
1450 IF V3=4 THEN GOTO 9900
1460 LET SUBBYWO$=V$
1490 GOTO 3900
1600 REM " --- Selected W/O Category
1620 LET V0$="S",V1$="C^",V2$=CATAGORY$,V3$="",V4$="WO Categories To Include (
1620:I=Inv'try, R=Recurring, N=Non-Stock), <F1>=All",V0=3,V1=40,V2=9
1630 PRINT @(V1,V2),'CL'
1640 GOSUB 7000
1650 IF V3=4 THEN GOTO 9900
1660 IF V$="" OR V3=1 THEN LET V$="IRN"
1670 GOSUB BUILDH3
1680 IF CATAGORY$<>"IRN" THEN GOTO 1730
1690 LET CATAGORY$="",H3$="All Categories"
1700 PRINT @(V1,V2),H3$
1720 GOTO 1790
1730 IF CATAGORY$="" THEN GOTO 1600
1740 PRINT @(V1,V2),CATAGORY$," ",H3$
1750 LET H3$=H3$+" Categories"
1790 GOTO 3900
1800 REM " --- Open/Closed/Both
1810 IF WOSTATUS$="" THEN LET WOSTATUS$="C"
1820 LET V0$="S",V1$="C",V2$=WOSTATUS$,V3$="OCB",V4$="C=Closed (Historical), O
1820:=Open, B=Both",V0=1,V1=40,V2=11
1840 GOSUB 7000
1850 IF V3=4 THEN GOTO 9900
1860 LET WOSTATUS$=V$
1890 GOTO 3900
3900 REM " --- Next Field
3910 IF V3=4 THEN GOTO 4000
3920 IF V3<>2 THEN GOTO 3950
3930 IF I0>0 THEN LET I0=I0-1
3940 GOTO 3960
3950 LET I0=I0+1
3960 ON I0 GOTO 1000,1200,1400,1600,1800,3900,4000
4000 REM " --- Overlay
4010 LET V0$="Y",V1$="C",V2$="Y",V3$="",V4$="Is The Above Information Correct?
4010: (Y/N): ",V0=1,V1=FNV(V4$),V2=22
4020 GOSUB 7000
4030 PRINT @(0,22),'CL'
4040 IF V3=4 THEN GOTO 9900
4060 IF V$="N" THEN GOTO 1000
4080 IF V$<>"Y" THEN GOTO 4000
4100 REM " --- Sort It Here
4110 CALL "SYC.GA",7,1,"","",STATUS
4115 IF STATUS THEN GOTO 9900
4120 CALL "SYC.NB","Now Sorting: ",8,COLUMN
4130 DIM A[11],B[5]
4140 READ (WOE01_DEV,KEY=N0$,DOM=4200)
4200 REM " --- W/O Header Here
4210 LET K$=KEY(WOE01_DEV,END=4900)
4220 IF POS(N0$=K$)<>1 THEN GOTO 4900
4230 READ (WOE01_DEV,KEY=K$)IOL=WOE01A
4240 IF POS(A0$(15,1)="QP")>0 THEN GOTO 4200
4250 IF DATEFROM$<>"" AND A0$(15,1)="C" AND A0$(31,3)<DATEFROM$ THEN GOTO 4210
4260 IF DATETHRU$<>"" AND A0$(16,3)>DATETHRU$ THEN GOTO 4210
4270 IF WOSTATUS$="C" AND A0$(15,1)<>"C" THEN GOTO 4210
4280 IF WOSTATUS$="O" AND A0$(15,1)="C" THEN IF DATETHRU$="" THEN GOTO 4210 EL
4280:SE IF A0$(31,3)<DATETHRU$ THEN GOTO 4210
4290 IF CATAGORY$<>"" THEN IF POS(A0$(14,1)=CATAGORY$)=0 THEN GOTO 4210
4300 REM " --- Include It This Time
4310 IF A0$(15,1)="C" AND A0$(31,3)<=PRIORPERENDDT$ THEN LET TRANS_DEV=WOT03_D
4310:EV ELSE LET TRANS_DEV=WOT01_DEV
4320 DIM B0$(14),B1$(30),B[5]
4330 LET B0$(1)=N0$,B0$(8,7)=A0$(5,7)
4340 IF SUBBYWO$="Y" THEN LET B0$(6,2)=A0$(12,2)
4350 PRINT @(COLUMN,11),A0$(5,7)
4400 REM " --- Standards Here
4410 DIM W[7]
4420 READ (WOE02_DEV,KEY=A0$(1,11)+"A",DOM=4430)
4430 LET K2$=KEY(WOE02_DEV,END=4600)
4440 IF POS(A0$(1,11)=K2$)<>1 THEN GOTO 4600
4450 READ (WOE02_DEV,KEY=K2$)IOL=WOE02A
4460 IF W1$(91,1)<>"S" THEN GOTO 4430
4470 LET B0$(3,3)=W1$(1,3)
4480 DIM B[5]
4490 FIND (WOW05_DEV,KEY=B0$,DOM=4500)IOL=WOW05A
4500 LET B[0]=B[0]+W[2],B[1]=B[1]+W[2]*W[6],B[2]=B[2]+W[3]-W[2]*W[6]
4510 WRITE (WOW05_DEV,KEY=B0$)IOL=WOW05A
4520 PRINT @(COLUMN,11),W0$(13,3)
4530 GOTO 4430
4600 REM " --- Actuals Here
4610 DIM W[11]
4620 READ (TRANS_DEV,KEY=A0$(1,11)+DATEFROM$,DOM=4630)
4630 LET K9$=KEY(TRANS_DEV,END=4800)
4640 IF POS(A0$(1,11)=K9$)<>1 THEN GOTO 4800
4650 IF DATETHRU$<>"" THEN IF K9$(12,3)>DATETHRU$ THEN GOTO 4800
4680 PRINT @(COLUMN,11),FNB$(K9$(12,3))
4690 READ (TRANS_DEV,KEY=K9$)IOL=WOT0103A
4700 DIM B[5]
4710 LET B0$(3,3)=W1$(4,3)
4720 FIND (WOW05_DEV,KEY=B0$,DOM=4730)IOL=WOW05A
4730 IF POS(" "<>B1$(1,3))=0 THEN LET B1$(1,3)=K9$(12,3)
4740 IF K9$(12,3)>B1$(4,3) THEN LET B1$(4,3)=K9$(12,3)
4750 LET B[3]=B[3]+W[0],B[4]=B[4]+W[0]*W[3],B[5]=B[5]+W[2]-W[0]*W[3]
4760 WRITE (WOW05_DEV,KEY=B0$)IOL=WOW05A
4770 GOTO 4630
4800 REM " --- Done..
4810 GOTO 4200
4900 REM " --- All Done
4910 RUN "WOR.FB"
6000 REM " --- Construct H3$, header string
6005 BUILDH3:
6010 LET CATAGORY$=""
6020 IF POS("I"=V$)>0 THEN LET CATAGORY$="I",H3$="Inventory"
6030 IF POS("R"=V$)<=0 THEN GOTO CHECK4N
6040 LET CATAGORY$=CATAGORY$+"R"
6050 IF CATAGORY$<>"R" THEN LET H3$=H3$+" And Recurring" ELSE LET H3$="Recurri
6050:ng"
6060 CHECK4N:
6070 IF POS("N"=V$)<=0 THEN GOTO 6190
6080 LET CATAGORY$=CATAGORY$+"N"
6090 IF CATAGORY$<>"N" THEN LET H3$=H3$+" And Non-Stocking" ELSE LET H3$="Non-
6090:Stocking"
6190 RETURN
7000 REM " --- Standard Input Routine (15May95)"
7010 CALL "SYC.IA",V0$,V1$,V2$,V3$,V4$,PGM(-2),V0,V1,V2,V$,V,V3,DISPLAY_LEN
7020 IF V3=999 THEN GOTO 7200
7030 IF V3=127 THEN GOTO 7100
7090 RETURN
7100 REM " --- Escape During Input"
7110 CALL "SYC.ES",ERR=7200,PGM(-2),TCB(8),E$,E2,V3
7120 IF V3<>127 THEN GOTO 7000
7130 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
7200 REM " --- Error During Input"
7210 ESCAPE
7290 GOTO 7000
8000 REM " --- Functions"
8010 DEF FNA$(Q$,Q2$)=STR(MOD((ASC(Q$)-32)*POS(" "<>Q2$(2,1)),100):"00")
8020 DEF FNB$(Q1$)=FNA$(Q1$(2),Q1$)+"/"+FNA$(Q1$(3),Q1$)+"/"+FNA$(Q1$(1),Q1$)
8095 DEF FNV(Q$)=42+INT(LEN(Q$)/2)
8145 REM " --- FNYY21_YY$ Un-Convert 21st Century 2-Char Year to 2-Char Year"
8150 DEF FNYY21_YY$(Q1$)
8155 LET Q3$=" 01234567890123456789",Q1$(1,1)=Q3$(POS(Q1$(1,1)=" 0123456789ABC
8155:DEFGHIJ"))
8160 RETURN Q1$
8165 FNEND
8170 REM " --- FNYY_YEAR Convert 2-Char Year to 21st Century Numeric Year"
8175 DEF FNYY_YEAR(Q1$)
8180 LET Q=NUM(FNYY21_YY$(Q1$)); IF Q<50 THEN LET Q=Q+100
8185 RETURN Q
8190 FNEND
9000 REM " --- Standard Error Routine (15May95)"
9010 IF ERR=127 THEN GOTO 9300
9020 CALL "SYC.EA",ERR=9090,EXIT_CTRL,PGM(-2),ERR,TCB(5),E$,E1,E2
9030 IF E1=1 THEN GOTO 9100
9040 IF E1=3 THEN GOTO 9200
9080 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9090 ESCAPE
9100 REM " --- Retry"
9190 RETRY
9200 REM " --- Return"
9210 SETERR 9000
9290 GOTO 9900
9300 REM " --- Standard Escape Routine"
9310 CALL "SYC.ES",ERR=9350,PGM(-2),TCB(8),E$,E2,V3
9320 IF V3<>127 THEN GOTO 9390
9330 PRINT @(0,E2),'CL','CURSOR'("ON"),E$,'LF'
9350 ESCAPE
9390 RETURN
9800 REM " --- Display Parameter record error"
9810 LET LINE_ERR$=LST(PGM(TCB(5)))
9820 CALL "SYC.YA",LINE_ERR$,N2$,ERR
9900 RUN "SYS.AA"
9999 END
